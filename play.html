<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Game - Play</title>
    <style>
        body { font-family: 'Arial', sans-serif; text-align: center; background: #e3f2fd; margin: 0; padding: 20px; }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 15px;
            background: #607d8b;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
        }

        .game-card { background: white; max-width: 400px; margin: 60px auto; padding: 30px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); position: relative; }
        .level-tag { background: #ff9800; color: white; padding: 5px 15px; border-radius: 15px; font-weight: bold; }
        .hearts { color: #f44336; font-size: 25px; margin: 15px 0; }
        #question { font-size: 60px; font-weight: bold; color: #1565c0; margin: 20px 0; }
        input { font-size: 30px; width: 120px; text-align: center; border: 3px solid #90caf9; border-radius: 10px; padding: 10px; outline: none; }
        .submit-btn { display: block; width: 100%; margin-top: 20px; padding: 15px; font-size: 20px; background: #4caf50; color: white; border: none; border-radius: 10px; cursor: pointer; }
        .submit-btn:active { background: #388e3c; }
        .score { margin-top: 15px; font-size: 18px; color: #555; }
    </style>
</head>
<body>

<a href="index.html" class="back-btn">⬅ Back</a>

<div class="game-card">
    <span class="level-tag" id="level-name">Level 1</span>
    <div class="hearts" id="hearts">❤️❤️❤️</div>
    
    <div id="question">--</div>
    <input type="number" id="user-answer" placeholder="?" pattern="\d*" inputmode="numeric">
    
    <button class="submit-btn" onclick="check()">Submit</button>
    <div class="score">Score: <span id="score">0</span></div>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const level = parseInt(params.get('level')) || 1;
    let score = 0;
    let lives = 3;
    let currentAns;

    // --- Sound Effects Logic ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSound(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);

        if (type === 'correct') {
            osc.type = 'sine';
            osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
            osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }
    }

    // --- Game Logic ---
    function nextQuestion() {
        let n1, n2, op;
        let max = 10; 

        switch(level) {
            case 1: op = '+'; break;
            case 2: op = '-'; break;
            case 3: op = Math.random() > 0.5 ? '+' : '-'; break;
            case 4: op = '*'; max = 6; break;
            case 5: 
                op = ['+','-','*'][Math.floor(Math.random()*3)];
                break;
            case 6: 
                op = ['+','-','*'][Math.floor(Math.random()*3)];
                max = 20; 
                break;
        }

        n1 = Math.floor(Math.random() * max) + 1;
        n2 = Math.floor(Math.random() * max) + 1;
        if (op === '-' && n1 < n2) [n1, n2] = [n2, n1];

        if (op === '+') currentAns = n1 + n2;
        if (op === '-') currentAns = n1 - n2;
        if (op === '*') { currentAns = n1 * n2; op = '×'; }

        document.getElementById('question').innerText = `${n1} ${op} ${n2}`;
        document.getElementById('level-name').innerText = "Level " + level;
        document.getElementById('user-answer').value = '';
        document.getElementById('user-answer').focus();
    }

    function check() {
        const input = document.getElementById('user-answer');
        const ans = parseInt(input.value);
        
        if (ans === currentAns) {
            playSound('correct');
            score += 10;
            document.getElementById('score').innerText = score;
            nextQuestion();
        } else {
            playSound('wrong');
            lives--;
            document.getElementById('hearts').innerText = "❤️".repeat(lives);
            if (lives <= 0) {
                alert("Game Over! Final Score: " + score);
                window.location.href = 'index.html';
            }
            input.value = '';
            input.focus();
        }
    }

    document.getElementById('user-answer').addEventListener('keyup', (e) => {
        if(e.key === 'Enter') check();
    });

    nextQuestion();
</script>

</body>
</html>
